---
title: V1 Migration Guide
sidebarTitle: V1 Migration
description: 'This guide is intended to help with migration to v1.'
---

## Breaking Changes

### `Cfgu` format changes

V1 introduces several breaking changes to `.cfgu` files. Below is a list of the breaking changes and how to update your `.cfgu` files.

#### `Cfgu` property changes

- The `type` property has been removed and replaced with the [new `test` property](#new-cfgu-property-test).
- The `options` property has been renamed to `enum` to better reflect its purpose.
- The `depends` property has been removed. If you need to replicate it, you can use the [new `test` property](#new-cfgu-property-test).
- The `labels` property has been renamed to `label`.
- The `template` property has been removed. If you need to replicate it, you can use the [new `const` property](#new-cfgu-property-const).

#### `.cfgu` file structure change

The file structure of `.cfgu` files has significantly changed to provide a more robust structure.

To update a `.cfgu` file to the new structure, the `Cfgu` declarations need to be moved under the `keys` property.

We will provide an example of how to migrate this example `.cfgu` file:

<CodeGroup>

```yaml example.cfgu.yaml
$schema: https://json-schema.org/draft/2020-12/schema-cfgu
NODE_ENV:
  description: Defines the environment in which the application runs
  type: String
  options:
    - development
    - production
    - test
  default: development
LOG_LEVEL:
  description: Defines the level of logs to be recorded
  type: String
  options:
    - error
    - warn
    - info
    - verbose
    - debug
    - silly
  default: info
SERVICE_ENDPOINT:
  description: Defines the endpoint for the service
  type: URL
  required: true
AWS_REGION:
  description: Defines the AWS region for the service
  type: AWSRegion
  default: us-east-1
```

```json example.cfgu.json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema-cfgu",
  "NODE_ENV": {
    "description": "Defines the environment in which the application runs",
    "type": "String",
    "options": ["development", "production", "test"],
    "default": "development"
  },
  "LOG_LEVEL": {
    "description": "Defines the level of logs to be recorded",
    "type": "String",
    "options": ["error", "warn", "info", "verbose", "debug", "silly"],
    "default": "info"
  },
  "SERVICE_ENDPOINT": {
    "description": "Defines the endpoint for the service",
    "type": "URL",
    "required": true
  },
  "AWS_REGION": {
    "description": "Defines the AWS region for the service",
    "type": "AWSRegion",
    "default": "us-east-1"
  }
}
```

</CodeGroup>

After migration:

<CodeGroup>

```yaml example.cfgu.yaml
$schema: https://json-schema.org/draft/2020-12/schema-cfgu
keys:
  NODE_ENV:
    description: Defines the environment in which the application runs
    test: validator.isString($.value)
    enum:
      - development
      - production
      - test
    default: development
  LOG_LEVEL:
    description: Defines the level of logs to be recorded
    test: validator.isString($.value)
    enum:
      - error
      - warn
      - info
      - verbose
      - debug
      - silly
    default: info
  SERVICE_ENDPOINT:
    description: Defines the endpoint for the service
    test: validator.isURL($.value)
    required: true
  AWS_REGION:
    description: Defines the AWS region for the service
    enum:
      - af-south-1
      - ap-east-1
      - ap-northeast-1
      - ap-northeast-2
      - ap-northeast-3
      - ap-south-1
      - ap-southeast-1
      - ap-southeast-2
      - ca-central-1
      - cn-north-1
      - cn-northwest-1
      - eu-central-1
      - eu-north-1
      - eu-south-1
      - eu-west-1
      - eu-west-2
      - eu-west-3
      - me-south-1
      - sa-east-1
      - us-east-1
      - us-east-2
      - us-gov-east-1
      - us-gov-west-1
      - us-west-1
      - us-west-2
    default: us-east-1
```

```json example.cfgu.json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema-cfgu",
  "keys": {
    "NODE_ENV": {
      "description": "Defines the environment in which the application runs",
      "test": "validator.isString($.value)",
      "enum": ["development", "production", "test"],
      "default": "development"
    },
    "LOG_LEVEL": {
      "description": "Defines the level of logs to be recorded",
      "test": "validator.isString($.value)",
      "enum": ["error", "warn", "info", "verbose", "debug", "silly"],
      "default": "info"
    },
    "SERVICE_ENDPOINT": {
      "description": "Defines the endpoint for the service",
      "test": "validator.isURL($.value)",
      "required": true
    },
    "AWS_REGION": {
      "description": "Defines the AWS region for the service",
      "enum": [
        "af-south-1",
        "ap-east-1",
        "ap-northeast-1",
        "ap-northeast-2",
        "ap-northeast-3",
        "ap-south-1",
        "ap-southeast-1",
        "ap-southeast-2",
        "ca-central-1",
        "cn-north-1",
        "cn-northwest-1",
        "eu-central-1",
        "eu-north-1",
        "eu-south-1",
        "eu-west-1",
        "eu-west-2",
        "eu-west-3",
        "me-south-1",
        "sa-east-1",
        "us-east-1",
        "us-east-2",
        "us-gov-east-1",
        "us-gov-west-1",
        "us-west-1",
        "us-west-2"
      ],
      "default": "us-east-1"
    }
  }
}
```

</CodeGroup>

### `.configu` file changes

The `cache` property has been renamed to `backup` to more accurately reflect its purpose. Replace all occurrences of `cache` with `backup` to reflect the new naming convention.

### CLI upsert command changes

The `--config, -c` flag has been renamed to `--kv` to avoid clashes with the new [`--config` global flag](#cli-global-config-flag). Replace all occurrences of `--config` with `--kv` to align with this updated naming convention.

A new method for declaring key-value pairs has also been introduced using the `-k`/`--key` and `-v`/`--value` flags. These flags must be used in sequence, with each key matched to the corresponding value provided immediately after. Keys without matching values will result in the deletion of their corresponding values.

For example, the following command:

```bash
configu upsert --store 'my-store' --set '' --schema start.cfgu.yaml \
    -k GREETING \
    -k SUBJECT \
    -v configu
```

Will:

- Delete the value of `GREETING`.
- Set the value of `SUBJECT` to `configu`.

These changes aim to improve clarity and prevent naming conflicts while providing flexibility for key-value management.

## Upgrading Configu CLI

TODO: get input from Ran
Install `@configu/cli` version 1.0.0 or later. Add snippet here.

## Upgrading Configu Proxy

TODO: get input from Ran
Install `@configu/proxy` version 1.0.0 or later.

## New Features

V1 introduces several new features to Configu. Below is a list of the new features and how to use them.

### Expressions

V1 introduces a new feature called expressions. Expressions allow you to write dynamic values with certain features like string interpolation, arithmetic operations, and more. All features that support expressions have their own injected context that can withing the expressions for evaluation.

The following features support expressions:

- [The new `test` `Cfgu` property](/interfaces/.cfgu#properties)
- [The new `const` `Cfgu` property](/interfaces/.cfgu#properties)
- [The `.configu` file](/interfaces/.configu#environment-variables)
- [The CLI export `filter` flag](/interfaces/cli/ref#configu-export)
- [The CLI export `format` flag](/interfaces/cli/ref#configu-export)
- [The CLI export `template` flag](/interfaces/cli/ref#configu-export)

Example usages of expressions:

`test` `Cfgu` property:

```yaml
keys:
  MY_STRING:
    test: validator.isString($.value)
```

The CLI export `filter` flag:

```bash
configu eval --store my-store --set '' --schema ./tmp/schemas2/start.cfgu.yaml | configu export --filter 'empty($.value)' --filter 'contains($.cfgu.label,"a")'
```

The CLI export `format` flag:

```bash
configu eval --store my-store --set '' --schema start.cfgu.yaml | configu export --format 'Dotenv({json:{{pipe}},wrap:true})'
```

The CLI export `template` flag, example template `.env` file:

```.env
SUBJECT={{SUBJECT}}
GREETING={{toUpper(GREETING)}}
```

### New `Cfgu` property `test`

The `test` property is a new property that allows you to write expressions to validate the value of a key. It replaces the `type` property which was removed due to its limited functionality.

### New `Cfgu` property `const`

The `const` property is a new property that allows you to write expressions to set a constant value for a key.

### CLI global `--config` flag

The `--config` flag is a new global flag that allows you to specify a path to `.configu` file to use for all commands. This flag is useful when you want to use a specific `.configu` file that you want to use for all commands.

### CLI `.configu` auto-detection

The CLI now automatically recursively searches for `.configu` files from the current working directory upwards to the home directory and uses the first one found for all commands when the `--config` flag is not provided.

## Other changes

### `@configu/node` and `@configu/browser` removal

Any and all uses of these packages are no longer supported. We encourage all users of these packages to utilize [`@configu/cli`](/interfaces/cli/overview) or [`@configu/proxy`](/interfaces/proxy/overview) depending on your requirements. All ConfigStore implementations have been moved to `@configu/integrations`.

### `@configu/lib` removal

Superseded by `@configu/common` which is a package that provides shared functionality for the higher-level interfaces.

### `@configu/ts` removal

Superseded by `@configu/sdk`.

### Introduction of `@configu/integrations`

A new package that contains all ConfigStore implementations and libraries that extend the expressions functionality which are decoupled from the core `@configu/sdk` package. This package is intended to be used by higher-level configu interfaces such as the CLI and proxy.
